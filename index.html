<!doctype html>
<html>
    <head>
        <title>js-bucket-listing</title>
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        />
        <style>
            body {
                margin: 30px 100px auto 100px;
            }
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="config.js"></script>
        <script>
            var bucketName = config.bucketName;
            var bucketRegion = config.bucketRegion;

            // Function to list objects in the bucket
            function listObjects() {
                var url = `https://${bucketName}.s3.${bucketRegion}.amazonaws.com/`;

                fetch(url)
                    .then((response) => response.text())
                    .then((data) => {
                        var parser = new DOMParser();
                        var xmlDoc = parser.parseFromString(data, "text/xml");
                        var contents = xmlDoc.getElementsByTagName("Contents");

                        var objectList = document.getElementById("objectList");
                        for (var i = 0; i < contents.length; i++) {
                            var key =
                                contents[i].getElementsByTagName("Key")[0]
                                    .textContent;

                            var listItem = document.createElement("li");
                            listItem.classList.add("list-group-item");

                            var link = document.createElement("a");
                            link.href = `https://js-bucket-listing.s3.amazonaws.com/${key}`;
                            link.textContent = key;

                            listItem.appendChild(link);
                            objectList.appendChild(listItem);
                        }
                    })
                    .catch((error) => {
                        console.log(error);
                    });
            }
        </script>
    </head>
    <body onload="listObjects()">
        <h3>js-bucket-listing</h3>
        <ul id="objectList"></ul>
    </body>
</html>
